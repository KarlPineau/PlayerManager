{# src/DnDRules/ClassDnDBundle/Resources/views/ClassDnD/view.html.twig #}
 
{% extends "DnDRulesClassDnDBundle:ClassDnD:layout.html.twig" %}

{% block title %}
    {{ classDnD.name }} - {{ parent() }}
{% endblock %}
    
{% block h1 %}
    {{ classDnD.name }}
{% endblock %}
    
{% block h1_extend %}
    {% if is_granted('ROLE_ADMIN') %}
        <div class="btn-group">
            <a class="btn btn-primary" href="{{ path('dndrules_classdnd_classdnd_edit', {'slug': classDnD.slug}) }}" >Modifier</a>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="caret"></span>
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right">
                <li><a class="" href="{{ path('dndrules_classdnd_classdnd_edit_bab', {'slug': classDnD.slug}) }}" >Edit BAB</a></li>
                <li><a class="" href="{{ path('dndrules_classdnd_classdnd_edit_st', {'slug': classDnD.slug}) }}" >Edit ST</a></li>
                <li><a class="" href="{{ path('dndrules_classdnd_classdnd_edit_sort', {'slug': classDnD.slug}) }}" >Edit Sort</a></li>
                <li><a class="" href="{{ path('dndrules_classdnd_classdnd_generateLevel', {'slug': classDnD.slug}) }}" >GenerateLevel</a></li>
                <li role="separator" class="divider"></li>
                <li><a class="bg-danger main-JS-delete" href="{{ path('dndrules_classdnd_classdnd_delete', {'slug': classDnD.slug}) }}" ><i class="fa fa-trash"></i> Supprimer</a></li>
            </ul>
        </div>
    {% endif %}
{% endblock %}

{% block breadcrumb %}
    {{ parent() }}
    <li class="active">{{classDnD.name}}</li>
{% endblock %} 

{% block PM_body %}
<div class="row">
    <section id="content" class="col-lg-12">
        {% for flashMessage in app.session.flashbag.get('notice') %}
            <div class="alert alert-success">
                {{ flashMessage }}
            </div>
        {% endfor %}
        
        <div class="row">
            <div class="col-md-6">
                {% if classDnD.description is not empty %}
                    <div class="well">
                        <h2>Description :</h2>
                        {{ classDnD.description|raw }}
                    </div>
                {% else %}
                    <div class="alert alert-warning" role="alert">Aucune description fournie pour cette classe.</div>
                {% endif %}
                <h2>Informations</h2>
                <ul>
                    <li>Dé de vie : {% if classDnD.diceHealth != null %}d{{ classDnD.diceHealth.dice }}{% else %}Non spécifié{% endif %}</li>
                </ul>
            </div>
        
            <div class="col-md-6">
                <h2>Compétences de Classe :</h2>
                <ul>
                {% for skill in classDnD.skills %}
                    <li><a href="{{path('dndrules_skill_skill_view', {'slug': skill.slug})}}" target="_blank">{{skill.name}}</a></li>
                {% else %}
                    <li>Aucune compétence connue</li>
                {% endfor %}
                </ul>
            </div>
        </div>
        
        <h2>Tableau des niveau :</h2>
        <table class="table table-bordered table-condensed table-striped">
            <tr>
                <th rowspan="3">Niveau</th>
                <th rowspan="3">BBA</th>
                <th colspan="3">JdS</th>
                <th colspan="20">Sorts</th>
            </tr>
            <tr>
                <th rowspan="2">Reflex</th>
                <th rowspan="2">Vigueur</th>
                <th rowspan="2">Volonté</th>
                {% for i in 0..9%}
                <th colspan="2">{{i}}</th>
                {% endfor %}
            </tr>
            <tr>
                {% for i in 0..9%}
                <th>C</th>
                <th>M/j</th>
                {% endfor %}
            </tr>
            
            {% for classDnDLevel in classDnDLevels %}
                <tr>
                    <td><a href="{{path('dndrules_level_level_view', {'level': classDnDLevel.level.level})}}" target="_blank">#{{classDnDLevel.level.level}}</a></td>
                    <td>
                        {% for bab in classDnDLevel.classBABs %}
                            {% if loop.index > 1 %}/{% endif %} {{bab.value}}
                        {% endfor %}
                    </td>
                    {% for st in classDnDLevel.classST%}
                    <td>{{st.fortitude}}</td>
                    <td>{{st.reflex}}</td>
                    <td>{{st.will}}</td>
                    {% endfor %}
                    {% for i in 0..9%}
                        {% for sort in classDnDLevel.classSorts %}
                            {% set levelMaximumKnownSorts = '' %}
                            {% if sort.sortLevel.level == i %}
                                {% set levelMaximumKnownSorts = sort.maximumKnownSorts %}
                    <td>{{sort.maximumKnownSorts}}</td>
                    <td>{{sort.maximumUsedSorts}}</td>
                            {% endif %}
                            {% if levelMaximumKnownSorts is empty %}
                    
                            {% endif %}
                        {% endfor %}
                        
                    {% endfor %}
                </tr>
            {% else %}
                <tr>
                    <td colspan="23"><em>Aucune information connue.</em></td>
                </tr>
            {% endfor %}
        </table>
        
        <hr />
        <h2>Sorts de la classe</h2>
        <div>
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                {% for sortsbylevel in allSorts %}
                    <li role="presentation" {% if sortsbylevel[0].level == 0 %} class="active" {% endif %}>
                        <a href="#sortlevel{{sortsbylevel[0].level}}" aria-controls="sortlevel{{sortsbylevel[0].level}}" role="tab" data-toggle="tab">{{sortsbylevel[0].level}}</a>
                    </li>
                {% endfor %}
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                {% for sortsbylevel in allSorts %}
                    <div role="tabpanel" class="tab-pane {% if sortsbylevel[0].level == 0 %}active{% endif %}" id="sortlevel{{sortsbylevel[0].level}}">
                        <ul>
                        {% for sort in sortsbylevel[1] %}
                            <li>
                                <a href="{{path('dndrules_sort_sort_view', {'slug': sort.slug})}}" target="_blank">{{sort.name}}</a>{% if not loop.last %},{% endif %}
                            </li>
                        {% else %}
                            <li>Pas de sort à ce niveau</li>
                        {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>
</div>
{% endblock %}